{% extends 'teach_base/base.html' %}
{% load static %}

{% block title %}Notify Exam - Teacher Dashboard{% endblock %}

{% block header_title %}Notify Exam{% endblock %}
{% block user_avatar %} {{teacher.teacher_image.url}} {% endblock %}
{% block extra_css %}
<style>
    /* Notify Exam page specific styles - FULL SCREEN */
    .exam-container {
        width: 100%;
        max-width: none;
        padding: 2rem;
        min-height: calc(100vh - 80px);
    }

    .exam-content {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 3rem;
        max-width: 1400px;
        margin: 0 auto;
    }

    .exam-left {
        display: flex;
        flex-direction: column;
    }

    .exam-right {
        display: flex;
        flex-direction: column;
    }
    
    .exam-header {
        text-align: center;
        margin-bottom: 2rem;
    }
    
    .exam-title {
        font-size: 2rem;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: 0.5rem;
    }
    
    .exam-subtitle {
        color: var(--text-secondary);
        font-size: 1rem;
    }
    
    .form-container {
        background: var(--bg-primary);
        border-radius: 16px;
        padding: 2rem;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        border: 1px solid var(--border-color);
        height: fit-content;
    }
    
    .form-group {
        margin-bottom: 1.5rem;
    }

    .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
    }
    
    .form-label {
        display: block;
        font-size: 0.875rem;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 0.5rem;
    }
    
    .form-input, .form-select, .form-textarea {
        width: 100%;
        padding: 0.75rem 1rem;
        border: 2px solid var(--border-color);
        border-radius: 12px;
        background-color: var(--bg-secondary);
        color: var(--text-primary);
        font-size: 1rem;
        transition: all 0.3s ease;
    }
    
    .form-input:focus, .form-select:focus, .form-textarea:focus {
        outline: none;
        border-color: var(--accent-color);
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }
    
    .form-textarea {
        min-height: 120px;
        resize: vertical;
    }
    
    .submit-btn {
        width: 100%;
        padding: 0.875rem 2rem;
        background: linear-gradient(135deg, var(--accent-color) 0%, #4f46e5 100%);
        color: white;
        border: none;
        border-radius: 12px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }
    
    .submit-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px -8px rgba(59, 130, 246, 0.5);
    }
    
    .submit-btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
    }
    
    .submit-btn.loading {
        color: transparent;
    }
    
    .loading-spinner {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 20px;
        height: 20px;
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        border-top-color: white;
        animation: spin 1s ease-in-out infinite;
        opacity: 0;
    }
    
    .submit-btn.loading .loading-spinner {
        opacity: 1;
    }
    
    @keyframes spin {
        to { transform: translate(-50%, -50%) rotate(360deg); }
    }
    
    /* Toast Notification Styles */
    .toast {
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 1rem 1.5rem;
        border-radius: 12px;
        color: white;
        font-weight: 500;
        z-index: 1000;
        transform: translateX(400px);
        transition: transform 0.3s ease;
        max-width: 350px;
        box-shadow: 0 10px 25px -3px rgba(0, 0, 0, 0.1);
    }
    
    .toast.show {
        transform: translateX(0);
    }
    
    .toast.success {
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    }
    
    .toast.error {
        background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
    }
    
    .toast-content {
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }
    
    .toast-icon {
        font-size: 1.25rem;
    }
    
    .toast-message {
        flex: 1;
        line-height: 1.4;
    }

    /* Recent Exam Notices Styles */
    .recent-exams-section {
        margin-top: 0;
        height: 100%;
    }

    .recent-exams-header {
        text-align: center;
        margin-bottom: 2rem;
    }

    .recent-exams-title {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: 0.5rem;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
    }

    .recent-exams-title i {
        color: var(--accent-color);
    }

    .recent-exams-subtitle {
        color: var(--text-secondary);
        font-size: 0.875rem;
    }

    .recent-exams-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 1.5rem;
        margin-bottom: 2rem;
        max-height: calc(100vh - 300px);
        overflow-y: auto;
        padding-right: 1rem;
    }

    .recent-exams-grid::-webkit-scrollbar {
        width: 8px;
    }

    .recent-exams-grid::-webkit-scrollbar-track {
        background: var(--bg-secondary);
        border-radius: 4px;
    }

    .recent-exams-grid::-webkit-scrollbar-thumb {
        background: var(--border-color);
        border-radius: 4px;
    }

    .recent-exams-grid::-webkit-scrollbar-thumb:hover {
        background: var(--accent-color);
    }

    .exam-notice-card {
        background: var(--bg-primary);
        border-radius: 16px;
        padding: 1.5rem;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        border: 1px solid var(--border-color);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }

    .exam-notice-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 10px 25px -3px rgba(0, 0, 0, 0.1);
    }

    .exam-notice-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 4px;
        height: 100%;
        background: var(--accent-color);
    }

    .exam-notice-card.urgent::before {
        background: #ef4444;
    }

    .exam-notice-card.upcoming::before {
        background: #f59e0b;
    }

    .exam-notice-card.completed::before {
        background: #10b981;
    }

    .exam-notice-header {
        display: flex;
        align-items: flex-start;
        justify-content: space-between;
        margin-bottom: 1rem;
    }

    .exam-notice-info {
        flex: 1;
    }

    .exam-notice-title {
        font-size: 1.125rem;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 0.25rem;
        line-height: 1.4;
    }

    .exam-notice-meta {
        font-size: 0.875rem;
        color: var(--text-secondary);
        margin-bottom: 0.5rem;
    }

    .exam-status {
        padding: 0.25rem 0.75rem;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }

    .exam-status.urgent {
        background-color: rgba(239, 68, 68, 0.1);
        color: #dc2626;
    }

    .exam-status.upcoming {
        background-color: rgba(245, 158, 11, 0.1);
        color: #d97706;
    }

    .exam-status.completed {
        background-color: rgba(16, 185, 129, 0.1);
        color: #059669;
    }

    .exam-notice-description {
        color: var(--text-secondary);
        font-size: 0.875rem;
        line-height: 1.5;
        margin-bottom: 1rem;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .exam-notice-details {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
        margin-bottom: 1rem;
    }

    .exam-detail {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.75rem;
        color: var(--text-secondary);
    }

    .exam-detail i {
        color: var(--accent-color);
        width: 16px;
        text-align: center;
    }

    .exam-notice-actions {
        display: flex;
        gap: 0.5rem;
        justify-content: flex-end;
    }

    .action-btn {
        padding: 0.5rem 1rem;
        border-radius: 8px;
        border: 1px solid var(--border-color);
        background-color: var(--bg-secondary);
        color: var(--text-secondary);
        cursor: pointer;
        transition: all 0.2s ease;
        font-size: 0.75rem;
        font-weight: 500;
    }

    .action-btn:hover {
        background-color: var(--accent-color);
        color: white;
        border-color: var(--accent-color);
    }

    .action-btn.primary {
        background-color: var(--accent-color);
        color: white;
        border-color: var(--accent-color);
    }

    .action-btn.primary:hover {
        background-color: #4f46e5;
    }

    .view-all-container {
        text-align: center;
    }

    .view-all-btn {
        padding: 0.75rem 2rem;
        background-color: var(--bg-secondary);
        color: var(--text-primary);
        border: 2px solid var(--border-color);
        border-radius: 12px;
        font-size: 0.875rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
    }

    .view-all-btn:hover {
        background-color: var(--accent-color);
        color: white;
        border-color: var(--accent-color);
        transform: translateY(-2px);
    }
    
    /* Mobile responsive adjustments for full screen */
    @media (max-width: 1024px) {
        .exam-content {
            grid-template-columns: 1fr;
            gap: 2rem;
        }
        
        .recent-exams-grid {
            max-height: none;
            overflow-y: visible;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        }
    }

    /* Mobile responsive adjustments */
    @media (max-width: 768px) {
        .exam-container {
            padding: 1rem;
        }
        
        .exam-content {
            gap: 1.5rem;
        }
        
        .form-container {
            padding: 1.5rem;
        }

        .form-row {
            grid-template-columns: 1fr;
        }
        
        .recent-exams-grid {
            grid-template-columns: 1fr;
            gap: 1rem;
        }
        
        .exam-notice-card {
            padding: 1.25rem;
        }
        
        .exam-notice-details {
            grid-template-columns: 1fr;
            gap: 0.5rem;
        }
        
        .exam-notice-actions {
            flex-direction: column;
        }
    }

    @media (max-width: 480px) {
        .exam-container {
            padding: 0.75rem;
        }
        
        .form-container {
            padding: 1rem;
        }
        
        .exam-title {
            font-size: 1.5rem;
        }
        
        .exam-notice-card {
            padding: 1rem;
        }
        
        .recent-exams-title {
            font-size: 1.25rem;
        }
    }
    
    /* Dark theme adjustments */
    [data-theme="dark"] .form-input,
    [data-theme="dark"] .form-select,
    [data-theme="dark"] .form-textarea {
        background-color: var(--bg-tertiary);
        border-color: var(--border-color);
        color: var(--text-primary);
    }
    
    [data-theme="dark"] .form-input::placeholder,
    [data-theme="dark"] .form-textarea::placeholder {
        color: var(--text-secondary);
    }
    
    /* Form validation styles */
    .form-input.error,
    .form-select.error,
    .form-textarea.error {
        border-color: #ef4444;
        box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
    }
    
    .error-message {
        color: #ef4444;
        font-size: 0.875rem;
        margin-top: 0.25rem;
        display: none;
    }
    
    .error-message.show {
        display: block;
    }
</style>
{% endblock %}

{% block page_title %}Notify Exam{% endblock %}

{% block content %}
<div class="exam-container">
    <div class="exam-content">
        <!-- Left Column - Exam Form -->
        <div class="exam-left">
            <div class="exam-header">
                <h1 class="exam-title">Notify Exam</h1>
                <p class="exam-subtitle">Create and send exam notifications to students</p>
            </div>
            
            <div class="form-container">
                <form id="examForm">
                    {% csrf_token %}
                    
                    <!-- Exam Title -->
                    <div class="form-group">
                        <label for="examTitle" class="form-label">
                            <i class="fas fa-graduation-cap" style="margin-right: 0.5rem; color: var(--accent-color);"></i>
                            Exam Title *
                        </label>
                        <input 
                            type="text" 
                            id="examTitle" 
                            name="exam_title" 
                            class="form-input" 
                            placeholder="e.g., Mid-Term Science Exam"
                            required
                        >
                        <div class="error-message" id="examTitle-error">Please enter an exam title</div>
                    </div>
                    
                    <!-- Subject -->
                    <div class="form-group">
                        <label for="subject" class="form-label">
                            <i class="fas fa-book" style="margin-right: 0.5rem; color: var(--accent-color);"></i>
                            Select Subject *
                        </label>
                        <select id="subject" name="subject" class="form-select" required>
                            <option value="">Choose a subject...</option>
                            <option value="mathematics">Mathematics</option>
                            <option value="science">Science</option>
                            <option value="english">English</option>
                            <option value="history">History</option>
                            <option value="geography">Geography</option>
                            <option value="physics">Physics</option>
                            <option value="chemistry">Chemistry</option>
                            <option value="biology">Biology</option>
                        </select>
                        <div class="error-message" id="subject-error">Please select a subject</div>
                    </div>
                    
                    <!-- Class and Section -->
                    <div class="form-row">
                        <div class="form-group">
                            <label for="class" class="form-label">
                                <i class="fas fa-users" style="margin-right: 0.5rem; color: var(--accent-color);"></i>
                                Select Class *
                            </label>
                            <select id="class" name="class" class="form-select" required>
                                <option value="">Choose a class...</option>
                                <option value="grade-6">Grade 6</option>
                                <option value="grade-7">Grade 7</option>
                                <option value="grade-8">Grade 8</option>
                                <option value="grade-9">Grade 9</option>
                                <option value="grade-10">Grade 10</option>
                                <option value="grade-11">Grade 11</option>
                                <option value="grade-12">Grade 12</option>
                            </select>
                            <div class="error-message" id="class-error">Please select a class</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="section" class="form-label">
                                <i class="fas fa-layer-group" style="margin-right: 0.5rem; color: var(--accent-color);"></i>
                                Select Section *
                            </label>
                            <select id="section" name="section" class="form-select" required>
                                <option value="">Choose a section...</option>
                                <option value="A">Section A</option>
                                <option value="B">Section B</option>
                                <option value="C">Section C</option>
                                <option value="D">Section D</option>
                                <option value="E">Section E</option>
                                <option value="F">Section F</option>
                            </select>
                            <div class="error-message" id="section-error">Please select a section</div>
                        </div>
                    </div>
                    
                    <!-- Exam Date -->
                    <div class="form-group">
                        <label for="examDate" class="form-label">
                            <i class="fas fa-calendar-alt" style="margin-right: 0.5rem; color: var(--accent-color);"></i>
                            Exam Date *
                        </label>
                        <input 
                            type="date" 
                            id="examDate" 
                            name="exam_date" 
                            class="form-input" 
                            required
                        >
                        <div class="error-message" id="examDate-error">Please select an exam date</div>
                    </div>
                    
                    <!-- Exam Time -->
                    <div class="form-row">
                        <div class="form-group">
                            <label for="startTime" class="form-label">
                                <i class="fas fa-clock" style="margin-right: 0.5rem; color: var(--accent-color);"></i>
                                Start Time *
                            </label>
                            <input 
                                type="time" 
                                id="startTime" 
                                name="start_time" 
                                class="form-input" 
                                required
                            >
                            <div class="error-message" id="startTime-error">Please select start time</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="endTime" class="form-label">
                                <i class="fas fa-clock" style="margin-right: 0.5rem; color: var(--accent-color);"></i>
                                End Time *
                            </label>
                            <input 
                                type="time" 
                                id="endTime" 
                                name="end_time" 
                                class="form-input" 
                                required
                            >
                            <div class="error-message" id="endTime-error">Please select end time</div>
                        </div>
                    </div>
                    
                    <!-- Exam Type -->
                    <div class="form-group">
                        <label for="examType" class="form-label">
                            <i class="fas fa-clipboard-list" style="margin-right: 0.5rem; color: var(--accent-color);"></i>
                            Exam Type *
                        </label>
                        <select id="examType" name="exam_type" class="form-select" required>
                            <option value="">Choose exam type...</option>
                            <option value="written">Written Exam</option>
                            <option value="oral">Oral Exam</option>
                            <option value="practical">Practical Exam</option>
                            <option value="online">Online Exam</option>
                            <option value="project">Project Submission</option>
                        </select>
                        <div class="error-message" id="examType-error">Please select exam type</div>
                    </div>
                    
                    <!-- Description -->
                    <div class="form-group">
                        <label for="description" class="form-label">
                            <i class="fas fa-align-left" style="margin-right: 0.5rem; color: var(--accent-color);"></i>
                            Exam Description / Instructions *
                        </label>
                        <textarea 
                            id="description" 
                            name="description" 
                            class="form-textarea" 
                            placeholder="Enter exam details, instructions, or special requirements..."
                            required
                        ></textarea>
                        <div class="error-message" id="description-error">Please enter exam description</div>
                    </div>
                    
                    <!-- Submit Button -->
                    <button type="submit" class="submit-btn" id="submitBtn">
                        <span class="btn-text">
                            <i class="fas fa-bell" style="margin-right: 0.5rem;"></i>
                            Send Notification
                        </span>
                        <div class="loading-spinner"></div>
                    </button>
                </form>
            </div>
        </div>
        
        <!-- Right Column - Recent Exam Notices -->
        <div class="exam-right">
            <div class="recent-exams-section">
                <div class="recent-exams-header">
                    <h2 class="recent-exams-title">
                        <i class="fas fa-bell"></i>
                        Recent Exam Notices
                    </h2>
                    <p class="recent-exams-subtitle">Latest exam notifications</p>
                </div>
                
                <div class="recent-exams-grid" id="recentExamsGrid">
                    <!-- Exam Notice Card 1 -->
                    <div class="exam-notice-card urgent">
                        <div class="exam-notice-header">
                            <div class="exam-notice-info">
                                <h3 class="exam-notice-title">Mid-Term Mathematics Exam</h3>
                                <p class="exam-notice-meta">Grade 9A • Mathematics • Tomorrow</p>
                            </div>
                            <span class="exam-status urgent">Urgent</span>
                        </div>
                        <div class="exam-notice-description">
                            Comprehensive exam covering algebra, geometry, and trigonometry. Students must bring calculators and drawing instruments.
                        </div>
                        <div class="exam-notice-details">
                            <div class="exam-detail">
                                <i class="fas fa-calendar"></i>
                                <span>Dec 15, 2024</span>
                            </div>
                            <div class="exam-detail">
                                <i class="fas fa-clock"></i>
                                <span>9:00 AM - 12:00 PM</span>
                            </div>
                            <div class="exam-detail">
                                <i class="fas fa-clipboard-list"></i>
                                <span>Written Exam</span>
                            </div>
                            <div class="exam-detail">
                                <i class="fas fa-users"></i>
                                <span>28 Students</span>
                            </div>
                        </div>
                        <div class="exam-notice-actions">
                            <button class="action-btn">Edit</button>
                            <button class="action-btn primary">View Details</button>
                        </div>
                    </div>
                    
                    <!-- Exam Notice Card 2 -->
                    <div class="exam-notice-card upcoming">
                        <div class="exam-notice-header">
                            <div class="exam-notice-info">
                                <h3 class="exam-notice-title">Science Practical Exam</h3>
                                <p class="exam-notice-meta">Grade 8B • Science • Next Week</p>
                            </div>
                            <span class="exam-status upcoming">Upcoming</span>
                        </div>
                        <div class="exam-notice-description">
                            Laboratory practical examination focusing on chemistry experiments and physics demonstrations.
                        </div>
                        <div class="exam-notice-details">
                            <div class="exam-detail">
                                <i class="fas fa-calendar"></i>
                                <span>Dec 20, 2024</span>
                            </div>
                            <div class="exam-detail">
                                <i class="fas fa-clock"></i>
                                <span>2:00 PM - 4:00 PM</span>
                            </div>
                            <div class="exam-detail">
                                <i class="fas fa-clipboard-list"></i>
                                <span>Practical Exam</span>
                            </div>
                            <div class="exam-detail">
                                <i class="fas fa-users"></i>
                                <span>25 Students</span>
                            </div>
                        </div>
                        <div class="exam-notice-actions">
                            <button class="action-btn">Edit</button>
                            <button class="action-btn primary">View Details</button>
                        </div>
                    </div>
                    
                    <!-- Exam Notice Card 3 -->
                    <div class="exam-notice-card completed">
                        <div class="exam-notice-header">
                            <div class="exam-notice-info">
                                <h3 class="exam-notice-title">English Literature Quiz</h3>
                                <p class="exam-notice-meta">Grade 11C • English • Last Week</p>
                            </div>
                            <span class="exam-status completed">Completed</span>
                        </div>
                        <div class="exam-notice-description">
                            Quick assessment on Shakespeare's works and modern poetry analysis. Results have been published.
                        </div>
                        <div class="exam-notice-details">
                            <div class="exam-detail">
                                <i class="fas fa-calendar"></i>
                                <span>Dec 8, 2024</span>
                            </div>
                            <div class="exam-detail">
                                <i class="fas fa-clock"></i>
                                <span>10:00 AM - 11:00 AM</span>
                            </div>
                            <div class="exam-detail">
                                <i class="fas fa-clipboard-list"></i>
                                <span>Online Quiz</span>
                            </div>
                            <div class="exam-detail">
                                <i class="fas fa-users"></i>
                                <span>22 Students</span>
                            </div>
                        </div>
                        <div class="exam-notice-actions">
                            <button class="action-btn">View Results</button>
                            <button class="action-btn primary">Download Report</button>
                        </div>
                    </div>
                    
                    <!-- Exam Notice Card 4 -->
                    <div class="exam-notice-card upcoming">
                        <div class="exam-notice-header">
                            <div class="exam-notice-info">
                                <h3 class="exam-notice-title">History Project Submission</h3>
                                <p class="exam-notice-meta">Grade 10A • History • Next Month</p>
                            </div>
                            <span class="exam-status upcoming">Upcoming</span>
                        </div>
                        <div class="exam-notice-description">
                            Final project on World War II timeline and impact. Students must submit both written report and presentation.
                        </div>
                        <div class="exam-notice-details">
                            <div class="exam-detail">
                                <i class="fas fa-calendar"></i>
                                <span>Jan 15, 2025</span>
                            </div>
                            <div class="exam-detail">
                                <i class="fas fa-clock"></i>
                                <span>All Day</span>
                            </div>
                            <div class="exam-detail">
                                <i class="fas fa-clipboard-list"></i>
                                <span>Project Submission</span>
                            </div>
                            <div class="exam-detail">
                                <i class="fas fa-users"></i>
                                <span>30 Students</span>
                            </div>
                        </div>
                        <div class="exam-notice-actions">
                            <button class="action-btn">Edit</button>
                            <button class="action-btn primary">View Details</button>
                        </div>
                    </div>
                </div>
                
                <!-- View All Button -->
                <div class="view-all-container">
                    <button class="view-all-btn">
                        <i class="fas fa-list"></i>
                        View All Exam Notices
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Toast Container -->
<div id="toastContainer"></div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('examForm');
    const submitBtn = document.getElementById('submitBtn');
    
    // Form validation
    function validateForm() {
        let isValid = true;
        const requiredFields = [
            { id: 'examTitle', message: 'Please enter an exam title' },
            { id: 'subject', message: 'Please select a subject' },
            { id: 'class', message: 'Please select a class' },
            { id: 'section', message: 'Please select a section' },
            { id: 'examDate', message: 'Please select an exam date' },
            { id: 'startTime', message: 'Please select start time' },
            { id: 'endTime', message: 'Please select end time' },
            { id: 'examType', message: 'Please select exam type' },
            { id: 'description', message: 'Please enter exam description' }
        ];
        
        // Clear previous errors
        document.querySelectorAll('.error-message').forEach(error => {
            error.classList.remove('show');
        });
        document.querySelectorAll('.form-input, .form-select, .form-textarea').forEach(field => {
            field.classList.remove('error');
        });
        
        requiredFields.forEach(field => {
            const element = document.getElementById(field.id);
            const errorElement = document.getElementById(field.id + '-error');
            
            if (!element.value.trim()) {
                element.classList.add('error');
                errorElement.textContent = field.message;
                errorElement.classList.add('show');
                isValid = false;
            }
        });
        
        // Validate time range
        const startTime = document.getElementById('startTime').value;
        const endTime = document.getElementById('endTime').value;
        
        if (startTime && endTime && startTime >= endTime) {
            const endTimeElement = document.getElementById('endTime');
            const endTimeError = document.getElementById('endTime-error');
            endTimeElement.classList.add('error');
            endTimeError.textContent = 'End time must be after start time';
            endTimeError.classList.add('show');
            isValid = false;
        }
        
        return isValid;
    }
    
    // Toast notification function
    function showToast(message, type = 'success') {
        const toast = document.createElement('div');
        toast.className = `toast ${type}`;
        
        const icon = type === 'success' ? 'fas fa-check-circle' : 'fas fa-exclamation-triangle';
        
        toast.innerHTML = `
            <div class="toast-content">
                <i class="${icon} toast-icon"></i>
                <div class="toast-message">${message}</div>
            </div>
        `;
        
        document.getElementById('toastContainer').appendChild(toast);
        
        // Show toast
        setTimeout(() => toast.classList.add('show'), 100);
        
        // Hide and remove toast
        setTimeout(() => {
            toast.classList.remove('show');
            setTimeout(() => toast.remove(), 300);
        }, 4000);
    }
    
    // Form submission
    form.addEventListener('submit', function(e) {
        e.preventDefault();
        
        if (!validateForm()) {
            showToast('Awh snap! Looks like some fields are empty! 😅', 'error');
            return;
        }
        
        // Show loading state
        submitBtn.classList.add('loading');
        submitBtn.disabled = true;
        
        // Simulate form submission
        setTimeout(() => {
            // Reset loading state
            submitBtn.classList.remove('loading');
            submitBtn.disabled = false;
            
            // Show success message
            showToast('🎉 Exam notification sent successfully! Students have been notified.', 'success');
            
            // Add to recent exams
            const formData = new FormData(form);
            const examData = {
                title: formData.get('exam_title'),
                subject: formData.get('subject'),
                class: formData.get('class'),
                section: formData.get('section'),
                date: formData.get('exam_date'),
                startTime: formData.get('start_time'),
                endTime: formData.get('end_time'),
                type: formData.get('exam_type'),
                description: formData.get('description')
            };

            addToRecentExams(examData);
            
            // Reset form
            form.reset();
            
            // Clear any error states
            document.querySelectorAll('.error-message').forEach(error => {
                error.classList.remove('show');
            });
            document.querySelectorAll('.form-input, .form-select, .form-textarea').forEach(field => {
                field.classList.remove('error');
            });
            
        }, 2000);
    });
    
    // Real-time validation
    const inputs = document.querySelectorAll('.form-input, .form-select, .form-textarea');
    inputs.forEach(input => {
        input.addEventListener('blur', function() {
            const errorElement = document.getElementById(this.id + '-error');
            if (this.value.trim()) {
                this.classList.remove('error');
                errorElement.classList.remove('show');
            }
        });
    });

    // Recent exam notices interaction
    const actionBtns = document.querySelectorAll('.action-btn');
    actionBtns.forEach(btn => {
        btn.addEventListener('click', function(e) {
            e.stopPropagation();
            
            const btnText = this.textContent.trim();
            if (btnText === 'Edit') {
                showToast('📝 Opening exam editor...', 'success');
            } else if (btnText === 'View Details') {
                showToast('👁️ Loading exam details...', 'success');
            } else if (btnText === 'View Results') {
                showToast('📊 Loading exam results...', 'success');
            } else if (btnText === 'Download Report') {
                showToast('⬇️ Downloading report...', 'success');
            }
        });
    });

    // View all exams button
    const viewAllBtn = document.querySelector('.view-all-btn');
    if (viewAllBtn) {
        viewAllBtn.addEventListener('click', function() {
            showToast('📚 Redirecting to all exam notices...', 'success');
        });
    }

    // Add new exam to recent exams after successful submission
    function addToRecentExams(examData) {
        const recentExamsGrid = document.getElementById('recentExamsGrid');
        const newExamCard = document.createElement('div');
        newExamCard.className = 'exam-notice-card urgent';
        
        const formatDate = (dateStr) => {
            const date = new Date(dateStr);
            return date.toLocaleDateString('en-US', { 
                month: 'short', 
                day: 'numeric', 
                year: 'numeric' 
            });
        };
        
        const formatTime = (timeStr) => {
            const [hours, minutes] = timeStr.split(':');
            const hour = parseInt(hours);
            const ampm = hour >= 12 ? 'PM' : 'AM';
            const displayHour = hour % 12 || 12;
            return `${displayHour}:${minutes} ${ampm}`;
        };
        
        newExamCard.innerHTML = `
            <div class="exam-notice-header">
                <div class="exam-notice-info">
                    <h3 class="exam-notice-title">${examData.title}</h3>
                    <p class="exam-notice-meta">${examData.class}${examData.section} • ${examData.subject} • Just created</p>
                </div>
                <span class="exam-status urgent">New</span>
            </div>
            <div class="exam-notice-description">
                ${examData.description}
            </div>
            <div class="exam-notice-details">
                <div class="exam-detail">
                    <i class="fas fa-calendar"></i>
                    <span>${formatDate(examData.date)}</span>
                </div>
                <div class="exam-detail">
                    <i class="fas fa-clock"></i>
                    <span>${formatTime(examData.startTime)} - ${formatTime(examData.endTime)}</span>
                </div>
                <div class="exam-detail">
                    <i class="fas fa-clipboard-list"></i>
                    <span>${examData.type}</span>
                </div>
                <div class="exam-detail">
                    <i class="fas fa-users"></i>
                    <span>-- Students</span>
                </div>
            </div>
            <div class="exam-notice-actions">
                <button class="action-btn">Edit</button>
                <button class="action-btn primary">View Details</button>
            </div>
        `;
        
        // Add to beginning of grid
        recentExamsGrid.insertBefore(newExamCard, recentExamsGrid.firstChild);
        
        // Add event listeners to new buttons
        const newActionBtns = newExamCard.querySelectorAll('.action-btn');
        newActionBtns.forEach(btn => {
            btn.addEventListener('click', function(e) {
                e.stopPropagation();
                
                const btnText = this.textContent.trim();
                if (btnText === 'Edit') {
                    showToast('📝 Opening exam editor...', 'success');
                } else if (btnText === 'View Details') {
                    showToast('👁️ Loading exam details...', 'success');
                }
            });
        });
        
        // Animate the new card
        newExamCard.style.opacity = '0';
        newExamCard.style.transform = 'translateY(-20px)';
        setTimeout(() => {
            newExamCard.style.transition = 'all 0.5s ease';
            newExamCard.style.opacity = '1';
            newExamCard.style.transform = 'translateY(0)';
        }, 100);
    }
});
</script>
{% endblock %}
